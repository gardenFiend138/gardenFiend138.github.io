<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel='stylesheet' type='text/css' href='reset.css'></link>
    <link rel='stylesheet' type='text/css' href='venomStyle.css'></link>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Arimo" rel="stylesheet">
    <!-- using version 3 of d3 -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://use.fontawesome.com/b64ad7832d.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="js/scripts.js"></script>
    <title>Venom LD-50 Visualization</title>

  </head>
  <body>
    
    <header>
      
      <div class='title-container'>
        <h1>Venom at a Glance</h1>
        <h3>
          Using D3.js to Visualize Attributes of Venomous Animals
        </h3>
      </div>
      
      <div class='icons'>
        <div>
        <a href="https://github.com/gardenFiend138/data-visualization">
          <i class="fa fa-github fa-3x" aria-hidden="true"></i>
        </a>
        <a href="https://www.linkedin.com/in/guy-wassather-678740b7">
          <i class="fa fa-linkedin fa-3x" aria-hidden="true"></i>
        </a>
      </div>
        <h5>Guy Wassather</h5>
      </div>
      
    </header>
    
    <div class='button-container'>
      <button id='graph'>Graph it</button>
      <button id='converge'>Where's the data converge?</button>
      <button id='force-graph'>BUBBLES!</button>
    </div>
    <!-- <img src="http://i.imgur.com/aCJQYUS.png" alt="snake-comic"> -->
  
    <div class="graphs">
        
    <script type="text/javascript">
    
    const margin = {top: 25,right: 100,bottom: 25, left: 100}
    const outerWidth = 500;
    const outerHeight = 250;
    const innerWidth =  outerWidth - margin.right - margin.left;
    const innerHeight = outerHeight - margin.top - margin.bottom - 20;
    const padding = margin;
    
    
    // dimensions of the svg viewport
    let svg = d3.select('.graphs').append('svg')
      .attr('class', 'bubbles')
      .attr('width', outerWidth)
      .attr('height', outerHeight)
      .style('padding', padding.right + padding.top)
      
    let g = svg.append('g')
      .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
      
    // const resetGElements = () => {
    //   svg.append('g')
    //     .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
    // }
    
    // using d3 scales allows us to keep our svg viewport within the browser window and scales our data to fit within the space
    // can be done manually with vanilla javascript, but it's not difficult math and is time consuming for a project with such a short timeline
    // the domain is set directly form the minimum and maximum values of the data
    // this is handlign the math behind normalizing the data for scaling purposes
    const xScale = d3.scale
      .linear()
      .domain([0, 14])
      .range([0, outerWidth]);
      
    const yScale = d3.scale
      .linear()
      .domain([1, 1200])
      .range([outerHeight, 0]); // invert values so it reads like a normal graph
      
    
    // with the radius, we invert the range so we have an inverse relationship between the ld50 of the venom and the radius of the circle
    const rScale = d3.scale
      .sqrt()
      .domain([.01, 1.0])
      .range([50, 1]);
    
    const xAxis = d3.svg
      .axis()
      .orient('bottom')
      .scale(xScale);
      
    const yAxis = d3.svg
      .axis()
      .orient('left')
      .scale(yScale);
    
    const xAxisGroup = g.append('g')
      .attr('class', 'axis')
      .attr('transform', 'translate(0' + ',' + outerHeight + ')');
      
    const yAxisGroup = g.append('g').attr('class', 'axis')
    
    const graph = {
      nodes: [{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{}]
    }
    
    const tooltip = svg.append('g')
      .attr('class', 'tooltip')
      .style('display', null)
    
    const circle = g.selectAll()
      .data(graph.nodes)
      .enter()
      .append('circle')
      
      console.log(graph.nodes)
      
              
    function render(data) {
      // using extent here to calculate min and max of the dataset
      // not needed due to defining the x, y, and r scales above
      // xScale.domain(d3.extent(data, function(d) { return d.fangsMM; }));
      // yScale.domain(d3.extent(data, function(d) { return d.venomYieldDryMG; }));
      // rScale.domain(d3.extent(data, function(d) { return d.ld50IV; }));
// console.log(data)
    // xAxisGroup.call(xAxis);
    // yAxisGroup.call(yAxis);
      
    const circles = svg.selectAll('circle');
    
    const ld50Radius = function(d) { return rScale(d.ld50IV); }
    
    // console.log(data);
    
    svg.selectAll('circle')
      // .attr('cx', function(d) { return xScale(d.fangsMM); })
      // .attr('cy', function(d) { return yScale(d.venomYieldDryMG); })
      .data(data)
      .attr('r', ld50Radius)
      .classed('node', true)
      .style('fill', 'blue')
      .style('opacity', .4)
      .style('stroke', 'black')
      .style('stroke-width', .3)
      .on('mouseover', function() { 
        tooltip.style('display', 'block' );
        
      })
      .on('mouseout', function() { tooltip.style('display', 'none' );})
      .on('mousemove', function(d) { 
        let xPos = d3.mouse(this)[0] - 15;
        let yPos = d3.mouse(this)[1] - 15;
        tooltip.attr('transform', 'translate(' + xPos + ',' + yPos + ')');
        tooltip.select('text')
          .text(d.commonName + ': ' + d.species )
      

      })
      
      
      
      tooltip.append('text')
        .data(data)
        .attr('cx', 15)
        .attr('cy', 15)
        .style('font-size', '12px')

              
      const shrinkCircles = () => {
        circles.attr('r', 5)
      };
      
      const growCircles = () => {
        xAxisGroup.call(xAxis);
        yAxisGroup.call(yAxis);
        circles.attr('r', ld50Radius)
          .attr('cx', function(d) { return xScale(d.fangsMM); })
          .attr('cy', function(d) { return yScale(d.venomYieldDryMG); })
      };
      
      // const circleData = () => {
      //   circles.attr('r', ld50Radius)
      // }
      
      const graphIt = (data) => {
        console.log(data)
        xAxisGroup.call(xAxis);
        yAxisGroup.call(yAxis);
        plotCircles();
      }
      
      const plotCircles = () => {
        circles 
          .attr('cx', function(d) { return xScale(d.fangsMM); })
          .attr('cy', function(d) { return yScale(d.venomYieldDryMG); })
          .attr('r', 5)
      }

     const force = d3.layout.force()
               .nodes(data)
               .charge(-150)
               .friction(.9)
               .alpha(.5)
               .size([innerHeight * 2, innerWidth / 2])
               .on('tick', ticked);

     function ticked() {
       circles
           .attr('cx', d => d.x)
           .attr('cy', d => d.y)
           .attr('r', ld50Radius);
     }
     
     function forceGraph() {
       $(".axis").html("");
       // svg.selectAll('#axis').remove();
       circles.call(force.drag());
       force.start();
     } 
     
     circles.call(force.drag());
     force.start();
     
     document.getElementById('graph').addEventListener('click', graphIt, shrinkCircles )
     document.getElementById('converge').addEventListener('click', growCircles)
     document.getElementById('force-graph').addEventListener('click', forceGraph)
      
    //not needed in this visualization, since I'm using static data,
    // but putting in here so that I remember to use it when pulling from 
    // web APIs in the future
    // circles.exit().remove();
    }
      
    // set measurements as numbers instead of strings 
    function type(d) {
      d.lengthCM = +d.lengthCM
      d.weightG = +d.weightG
      d.fangsMM = +d.fangsMM
      d.venomYieldDryMG = +d.venomYieldDryMG
      d.ld50IV = +d.ld50IV
      d.species = d.species
      
      return d;
    }
    
    d3.csv('venomData.csv', type, render);

    </script>
    
    <div class='instructions'>
      <!-- <button onclick='close()' type="close-button">&times;</button> -->
      <p>
        <span class='instructions-title'>What in tarnation am I looking at?!</span>
      </br></br>
        Hello and welcome! This is a visualization of various attributes of venomous snakes in relation to the toxicity of their venom. 
      </br></br>
        The toxicity of venom (LD-50) is measured as the mg/kg required to be fatal to 50% of the test population. In this visualization, the size of the circle represents the LD-50 of each venom.
        <br/></br>
        If you click the either 'graph' or 'data convergence' buttons, you will see the venoms graphed, with the X axis being the maximum fang length measured in MM, and the Y axis being the average venom yield (dried) measured in MG.
        
        
      </p>
    </div>
    </div>
  </body>
  <!-- <footer>
    <div>
      <i class="fa fa-github fa-3x" aria-hidden="true"></i>
      <i class="fa fa-linkedin fa-3x" aria-hidden="true"></i>
    </div>
  </footer> -->
</html>


